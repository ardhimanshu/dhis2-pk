<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Dhis2-pocket-knife by davidhuser</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Dhis2-pocket-knife</h1>
        <p>Command-line tools for interacting with DHIS2 API in bulk</p>

        <p class="view"><a href="https://github.com/davidhuser/dhis2-pocket-knife">View the Project on GitHub <small>davidhuser/dhis2-pocket-knife</small></a></p>


        <ul>
          <li><a href="https://github.com/davidhuser/dhis2-pocket-knife/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/davidhuser/dhis2-pocket-knife/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/davidhuser/dhis2-pocket-knife">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="dhis2-pocket-knife" class="anchor" href="#dhis2-pocket-knife" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dhis2-pocket-knife</h1>

<p>Command-line tools to interact with <a href="https://dhis2.org">DHIS2</a> REST API in bulk.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<ul>
<li>
<em>pip</em> (python package manager) must be installed (check <a href="https://pip.pypa.io/en/stable/installing">installation instructions</a>)</li>
<li><code>pip install dhis2-pocket-knife</code></li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li>In a terminal, run <code>dhis2-pk-&lt;scriptname&gt; --argument=&lt;something&gt;</code> and the arguments as required. It should be callable from anywhere, no need to change directories.</li>
<li>Get help on using arguments: <code>dhis2-pk-&lt;scriptname&gt; --help</code>
</li>
<li>Be sure the specified user has the authorities to run these tasks for the specified DHIS2 server.</li>
<li>Logs to a log file called <code>dhis2-pk.log</code>
</li>
</ul>

<hr>

<h2>
<a id="bulk-sharing-settings-of-objects" class="anchor" href="#bulk-sharing-settings-of-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bulk sharing settings of objects</h2>

<p><strong>Script name:</strong> <code>dhis2-pk-share-objects</code></p>

<p>Apply sharing settings for DHIS2 metadata objects (dataElements, indicators, programs, ...) based on metadata object filtering. This assumes structured object properties (e.g. all object names / codes have the same prefix or suffix).</p>

<table>
<thead>
<tr>
<th>argument</th>
<th>description</th>
<th>required</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>-s</code> / <code>--server</code>
</td>
<td>Server base, e.g. <code>play.dhis2.org/demo</code>
</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-t</code> / <code>--object_type</code>
</td>
<td>Type of object, e.g. <code>dataElements</code>
</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-f</code> / <code>--filter</code>
</td>
<td>Object filter(s) in single quotes (<code>'xx'</code>): <code>-f='name:like:vaccine'</code> <strong><a href="https://dhis2.github.io/dhis2-docs/master/en/developer/html/dhis2_developer_manual_full.html#webapi_metadata_object_filter">Docs</a></strong>
</td>
<td>yes</td>
</tr>
<tr>
<td>
<code>-w</code> / <code>--usergroup_readwrite</code>
</td>
<td>Exact name of usergroup which should get <em>Read-Write</em> access to objects</td>
<td>no</td>
</tr>
<tr>
<td>
<code>-r</code> / <code>--usergroup_readonly</code>
</td>
<td>Exact name of usergroup which should get <em>Read-Only</em> access to objects</td>
<td>no</td>
</tr>
<tr>
<td>
<code>-a</code> / <code>--publicaccess</code>
</td>
<td>Public access (with login), one of: <code>readwrite</code>, <code>readonly</code>, <code>none</code>
</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-u</code> / <code>--username</code>
</td>
<td>DHIS2 username</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-p</code> / <code>--password</code>
</td>
<td>DHIS2 password</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-d</code> / <code>--debug</code>
</td>
<td>Log more info to log file</td>
<td>no</td>
</tr>
</tbody>
</table>

<p>Example (try it out against DHIS2 demo instance):</p>

<pre><code>dhis2-pk-share-objects --server=play.dhis2.org/demo --object_type=dataElements --filter='name:^like:All&amp;name:!like:cough' --usergroup_readwrite='Africare HQ' --usergroup_readonly='Bo District M&amp;E officers' --publicaccess=none --username=admin --password=district
</code></pre>

<h2>
<a id="find-users-with-a-misconfigured-organisation-unit-assignment" class="anchor" href="#find-users-with-a-misconfigured-organisation-unit-assignment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Find users with a misconfigured Organisation Unit assignment</h2>

<p><strong>Script name:</strong> <code>dhis2-pk-user-orgunits</code></p>

<p>Writes all users of an Organisation Unit who are configured like below to a <strong>csv file</strong>. Users who are assigned both an Orgunit <strong>and</strong> sub-Orgunit can be a source of access errors.
<img src="https://i.imgur.com/MXiALrL.png" alt="issue"></p>

<table>
<thead>
<tr>
<th>argument</th>
<th>description</th>
<th>required</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>-s</code> / <code>--server</code>
</td>
<td>Server base, e.g. <code>play.dhis2.org/demo</code>
</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-o</code> / <code>--orgunit</code>
</td>
<td>Orgunit UID to check its users</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-u</code> / <code>--username</code>
</td>
<td>DHIS2 username</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-p</code> / <code>--password</code>
</td>
<td>DHIS2 password</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-d</code> / <code>--debug</code>
</td>
<td>Log more info to log file</td>
<td>no</td>
</tr>
</tbody>
</table>

<p>Example:</p>

<pre><code>dhis2-pk-user-orgunits --server=play.dhis2.org/demo --orgunit=O6uvpzGd5pu --username=admin --password=district
</code></pre>

<h2>
<a id="bulk-deletion-of-metadata-objects" class="anchor" href="#bulk-deletion-of-metadata-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bulk deletion of metadata objects</h2>

<p><strong>Script name:</strong> <code>dhis2-pk-delete-objects</code></p>

<p>Delete metadata objects based on a list of UIDs in a text file. Note: <a href="https://github.com/baosystems/dish2#remove-metadata-objects">baosystems/dish2</a> may be an alternative.</p>

<table>
<thead>
<tr>
<th>argument</th>
<th>description</th>
<th>required</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>-s</code> / <code>--server</code>
</td>
<td>Server base, e.g. <code>play.dhis2.org/demo</code>
</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-t</code> / <code>--object_type</code>
</td>
<td>Type of metadata object, e.g. <code>dataElements</code>
</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-i</code> / <code>--uid_file</code>
</td>
<td>Text file with UIDs split by newline/break</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-u</code> / <code>--username</code>
</td>
<td>DHIS2 username</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-p</code> / <code>--password</code>
</td>
<td>DHIS2 password</td>
<td><strong>yes</strong></td>
</tr>
<tr>
<td>
<code>-d</code> / <code>--debug</code>
</td>
<td>Log more info to log file</td>
<td>no</td>
</tr>
</tbody>
</table>

<p>Example:</p>

<pre><code>dhis2-pk-delete-objects --server=play.dhis2.org/demo --uid_file='UIDs.txt' --username=admin --password=district
</code></pre>

<p>(put the following in a file called UIDs.txt to test it):</p>

<pre><code>FHD3wiSM7Sn
iKGjnOOaPlE
XTqOHygxDj5
</code></pre>

<hr>

<h3>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TODO</h3>

<p><del>- debug flag as optional argument</del></p>

<p>share-objects.py:</p>

<ul>
<li>arguments: userGroups: multiple names as arguments</li>
<li>arguments: userGroups: UID as argument</li>
<li>arguments: support for omitting field filters (= apply for all objects)</li>
</ul>

<p>user-orgunits.py:</p>

<ul>
<li>validating "data analysis" org unit tree as well (=dataViewOrganisationUnits)</li>
</ul>

<hr>

<p>PyPI link: <a href="https://pypi.python.org/pypi/dhis2-pocket-knife">https://pypi.python.org/pypi/dhis2-pocket-knife</a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/davidhuser">davidhuser</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
